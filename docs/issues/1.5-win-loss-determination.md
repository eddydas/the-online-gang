# Issue 1.5: Win/Loss Determination (TDD)

**Sprint:** 1
**Priority:** CRITICAL
**Estimate:** 10 hours
**Status:** TODO

## Description
Implement win/loss determination logic that validates token selections against actual hand rankings, including tie handling.

## Tests First (Write These Before Implementation)
- [ ] Sort players by hand strength (strongest â†’ weakest)
- [ ] Detect correct token ordering (descending: N, N-1, ..., 1)
- [ ] Handle tie scenarios (tied players can swap tokens)
- [ ] Validate tokens for each turn (not just Turn 4)
- [ ] Return win/loss result
- [ ] Generate expected token order

## Implementation Tasks
- [ ] Player sorting by hand strength (using poker evaluation)
- [ ] Token order validation (check if tokens match rankings)
- [ ] Tie logic (players with identical hands acceptable in either order)
- [ ] Per-turn validation capability
- [ ] Win/loss calculation (ALL correct = WIN, ANY wrong = LOSS)
- [ ] Expected token order generator (for debugging/UI)

## Type Safety
```javascript
// @ts-check

/**
 * @typedef {Object} PlayerWithHand
 * @property {string} id - Player ID
 * @property {string} name - Player name
 * @property {HandResult} hand - Evaluated hand
 * @property {number} currentToken - Selected token number
 */

/**
 * @typedef {Object} WinLossResult
 * @property {boolean} isWin - True if all players correct
 * @property {PlayerWithHand[]} sortedPlayers - Players sorted by hand strength
 * @property {Object.<string, boolean>} correctness - Map of playerId to isCorrect
 * @property {number[]} expectedTokens - Expected token order
 */

/**
 * Determines win/loss based on token selections
 * @param {PlayerWithHand[]} players - All players with hands
 * @returns {WinLossResult} Win/loss determination
 */
```

## Files to Create/Modify
- `src/winCondition.js` - Win/loss logic implementation
- `tests/winCondition.test.js` - Comprehensive tests

## Acceptance Criteria
- [ ] Correctly sorts players by hand strength
- [ ] Detects WIN when all tokens match rankings
- [ ] Detects LOSS when any token mismatched
- [ ] **Critical:** Tied hands can swap tokens and still win
- [ ] All tests pass (`npm test`)
- [ ] >80% code coverage
- [ ] Type checking passes (`npm run typecheck`)

## Tie Handling (Critical Edge Case)
**Example:**
- Player A: Pair of Aces (A-A-K-Q-J) with Token 2
- Player B: Pair of Aces (A-A-K-Q-J) with Token 3
- **Result:** WIN (tied players acceptable in either order)

**Test scenarios:**
- 2 players tied for 1st
- 2 players tied for 2nd/3rd
- 3+ players tied
- Tied players with wrong token range (e.g., tokens 1 and 5 instead of 2 and 3)
