# Issue 2.5: Top Bar UI Components

**Sprint:** 2 v2
**Priority:** HIGH
**Estimate:** 4 hours
**Status:** TODO

## Description
Implement the top bar UI with essential game controls: game code display, copy link button, turn indicator, phase indicator, timer, and help button (poker rankings).

## User Story
As a player, I want to see game information and controls at the top of the screen so that I can always access essential game features and understand the current game state.

## Acceptance Criteria
- [ ] Top bar always visible (sticky positioning)
- [ ] Game code displayed prominently
- [ ] "Copy Game Link" button (copies invite URL to clipboard)
- [ ] Turn indicator (Turn 1/4, Turn 2/4, etc.)
- [ ] Phase indicator (Lobby, Ready Up, Token Trading, End Game)
- [ ] Timer display (turn countdown or elapsed time)
- [ ] "?" button for poker hand rankings modal (links to Issue 2.1)
- [ ] Responsive layout (stacks vertically on mobile)
- [ ] High contrast colors (readable on poker green background)
- [ ] Icons or clear labels for all controls

## HTML Structure
```html
<div class="top-bar">
  <!-- Left Section: Game Info -->
  <div class="top-bar-left">
    <div class="game-code-display">
      <span class="label">Game:</span>
      <span class="code" id="game-code">ABC123</span>
      <button id="copy-link-btn" class="icon-btn" aria-label="Copy game link">
        ðŸ“‹
      </button>
    </div>
  </div>

  <!-- Center Section: Game State -->
  <div class="top-bar-center">
    <div class="turn-display">
      <span class="label">Turn:</span>
      <span id="turn-number">1 / 4</span>
    </div>
    <div class="phase-display">
      <span id="phase-name">Token Trading</span>
    </div>
    <div class="timer-display">
      <span id="timer">2:30</span>
    </div>
  </div>

  <!-- Right Section: Help -->
  <div class="top-bar-right">
    <button id="poker-rankings-button" class="icon-btn" aria-label="Poker Hand Rankings">
      ?
    </button>
  </div>
</div>
```

## CSS Styling
```css
/* Top Bar Container */
.top-bar {
  position: sticky;
  top: 0;
  left: 0;
  width: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  color: white;
  padding: 12px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 1000;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

/* Left Section */
.top-bar-left {
  flex: 1;
  display: flex;
  align-items: center;
}

.game-code-display {
  display: flex;
  align-items: center;
  gap: 8px;
}

.game-code-display .label {
  font-size: 12px;
  color: #95a5a6;
  text-transform: uppercase;
}

.game-code-display .code {
  font-size: 18px;
  font-weight: bold;
  color: #f39c12;
  letter-spacing: 2px;
  font-family: "Courier New", monospace;
}

/* Center Section */
.top-bar-center {
  flex: 2;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 24px;
}

.turn-display,
.phase-display,
.timer-display {
  display: flex;
  align-items: center;
  gap: 4px;
}

.turn-display .label {
  font-size: 12px;
  color: #95a5a6;
  text-transform: uppercase;
}

#turn-number {
  font-size: 16px;
  font-weight: bold;
  color: #ecf0f1;
}

#phase-name {
  font-size: 14px;
  font-weight: 600;
  color: #3498db;
  text-transform: uppercase;
  letter-spacing: 1px;
}

#timer {
  font-size: 16px;
  font-weight: bold;
  color: #e74c3c;
  font-family: "Courier New", monospace;
}

/* Right Section */
.top-bar-right {
  flex: 1;
  display: flex;
  justify-content: flex-end;
}

/* Icon Buttons */
.icon-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  color: white;
  font-size: 18px;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.icon-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.05);
}

.icon-btn:active {
  transform: scale(0.95);
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .top-bar {
    flex-direction: column;
    gap: 8px;
    padding: 8px 12px;
  }

  .top-bar-left,
  .top-bar-center,
  .top-bar-right {
    flex: unset;
    width: 100%;
    justify-content: center;
  }

  .top-bar-center {
    gap: 16px;
  }

  .game-code-display .code {
    font-size: 14px;
  }

  #turn-number,
  #timer {
    font-size: 14px;
  }

  #phase-name {
    font-size: 12px;
  }
}
```

## JavaScript Implementation

### Copy Game Link
```javascript
/**
 * Copy game invite link to clipboard
 */
function copyGameLink() {
  const gameCode = getGameCode();
  const inviteUrl = `${window.location.origin}?join=${gameCode}`;

  navigator.clipboard.writeText(inviteUrl)
    .then(() => {
      showCopyFeedback('Link copied!');
    })
    .catch(err => {
      console.error('Failed to copy:', err);
      showCopyFeedback('Failed to copy');
    });
}

/**
 * Show visual feedback for copy action
 * @param {string} message - Feedback message
 */
function showCopyFeedback(message) {
  const btn = document.getElementById('copy-link-btn');
  const originalText = btn.textContent;

  btn.textContent = 'âœ“';
  btn.style.color = '#2ecc71';

  setTimeout(() => {
    btn.textContent = originalText;
    btn.style.color = '';
  }, 2000);
}

// Event listener
document.getElementById('copy-link-btn')?.addEventListener('click', copyGameLink);
```

### Update Top Bar State
```javascript
/**
 * Update top bar with current game state
 * @param {GameState} gameState - Current game state
 */
function updateTopBar(gameState) {
  // Update turn number
  const turnEl = document.getElementById('turn-number');
  if (turnEl) {
    turnEl.textContent = `${gameState.turn} / 4`;
  }

  // Update phase name
  const phaseEl = document.getElementById('phase-name');
  if (phaseEl) {
    const phaseName = getPhaseDisplayName(gameState.phase);
    phaseEl.textContent = phaseName;

    // Color code by phase
    phaseEl.style.color = getPhaseColor(gameState.phase);
  }

  // Update timer (if applicable)
  updateTimerDisplay(gameState);
}

/**
 * Get display name for game phase
 * @param {Phase} phase - Current phase
 * @returns {string}
 */
function getPhaseDisplayName(phase) {
  const names = {
    'LOBBY': 'Lobby',
    'READY_UP': 'Ready Up',
    'TOKEN_TRADING': 'Token Trading',
    'TURN_COMPLETE': 'Turn Complete',
    'END_GAME': 'End Game'
  };
  return names[phase] || phase;
}

/**
 * Get color for game phase
 * @param {Phase} phase - Current phase
 * @returns {string}
 */
function getPhaseColor(phase) {
  const colors = {
    'LOBBY': '#95a5a6',         // Gray
    'READY_UP': '#3498db',       // Blue
    'TOKEN_TRADING': '#f39c12',  // Orange
    'TURN_COMPLETE': '#9b59b6',  // Purple
    'END_GAME': '#2ecc71'        // Green
  };
  return colors[phase] || '#ecf0f1';
}
```

### Timer Implementation (Optional)
```javascript
let timerInterval = null;
let startTime = null;

/**
 * Start turn timer
 * @param {number} durationSeconds - Timer duration in seconds (optional)
 */
function startTimer(durationSeconds = null) {
  stopTimer(); // Clear any existing timer

  startTime = Date.now();

  timerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);

    if (durationSeconds) {
      // Countdown timer
      const remaining = durationSeconds - elapsed;
      if (remaining <= 0) {
        stopTimer();
        updateTimerDisplay({ text: '0:00', color: '#e74c3c' });
      } else {
        const minutes = Math.floor(remaining / 60);
        const seconds = remaining % 60;
        updateTimerDisplay({ text: `${minutes}:${seconds.toString().padStart(2, '0')}`, color: '#ecf0f1' });
      }
    } else {
      // Elapsed timer
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      updateTimerDisplay({ text: `${minutes}:${seconds.toString().padStart(2, '0')}`, color: '#95a5a6' });
    }
  }, 1000);
}

/**
 * Stop timer
 */
function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

/**
 * Update timer display
 * @param {object} options - Display options
 */
function updateTimerDisplay(options = {}) {
  const timerEl = document.getElementById('timer');
  if (timerEl) {
    if (options.text) {
      timerEl.textContent = options.text;
    }
    if (options.color) {
      timerEl.style.color = options.color;
    }
  }
}
```

## Integration Points

### In gameController.js
```javascript
// Update top bar on state changes
onStateUpdate(newState) {
  // ... existing logic ...
  updateTopBar(newState);
}

// Start timer when entering TOKEN_TRADING phase
if (newState.phase === 'TOKEN_TRADING') {
  startTimer(); // Or startTimer(120) for 2-minute countdown
}
```

### In main.js
```javascript
// Initialize top bar
window.addEventListener('DOMContentLoaded', () => {
  // Set game code
  const gameCodeEl = document.getElementById('game-code');
  if (gameCodeEl) {
    gameCodeEl.textContent = getGameCode();
  }

  // Add event listeners
  document.getElementById('copy-link-btn')?.addEventListener('click', copyGameLink);
  document.getElementById('poker-rankings-button')?.addEventListener('click', openPokerRankingsModal);
});
```

## Files to Create/Modify
- `dist/index.html` - Add top bar HTML structure
- `src/browser/topBar.js` - New module for top bar logic
- `src/browser/gameController.js` - Call updateTopBar() on state changes
- `src/browser/main.js` - Initialize top bar and event listeners
- CSS file or inline styles for top bar

## Testing Checklist
- [ ] Top bar always visible at top of screen (sticky)
- [ ] Game code displays correctly
- [ ] Copy link button copies correct URL to clipboard
- [ ] Copy feedback displays (âœ“ checkmark for 2 seconds)
- [ ] Turn indicator updates (1/4, 2/4, 3/4, 4/4)
- [ ] Phase indicator displays correct phase name
- [ ] Phase color changes by phase (gray, blue, orange, purple, green)
- [ ] Timer displays and updates every second (if implemented)
- [ ] "?" button opens poker rankings modal
- [ ] Mobile layout stacks vertically
- [ ] All text is readable on dark background
- [ ] Touch targets are 44px minimum (mobile)

## Accessibility
- [ ] All buttons have aria-label
- [ ] Keyboard navigation works (Tab, Enter)
- [ ] High contrast colors (WCAG AA compliant)
- [ ] Screen reader announces phase changes (aria-live)

## Dependencies
- Issue 2.1 (Poker Rankings Modal) - "?" button links to modal
- Game code management (existing in gameState.js or p2pSync.js)

## Notes
- Top bar should work in all phases (Lobby â†’ End Game)
- Copy link button is critical for inviting new players
- Timer is optional for MVP (can be added later)
- Phase colors help players understand game flow
- Mobile layout must not obscure game area

## Definition of Done
- [ ] Top bar always visible with sticky positioning
- [ ] Game code and copy link button work correctly
- [ ] Turn and phase indicators update accurately
- [ ] Poker rankings "?" button opens modal
- [ ] Mobile responsive layout works
- [ ] All buttons accessible via keyboard
- [ ] Tested on Safari iOS, macOS, iPad
- [ ] Code passes typecheck
- [ ] Approved by product owner
