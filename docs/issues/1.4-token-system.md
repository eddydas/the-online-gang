# Issue 1.4: Token System (TDD)

**Sprint:** 1
**Priority:** CRITICAL
**Estimate:** 10 hours
**Status:** TODO

## Description
Implement the token selection and trading system, including stealing mechanics and conflict resolution.

## Tests First (Write These Before Implementation)
- [ ] Generate N tokens (where N = player count)
- [ ] Token selection assigns to player
- [ ] Token stealing transfers ownership
- [ ] Conflict resolution (timestamp-based, earlier wins)
- [ ] Token history tracking (4 turns)
- [ ] Placeholder logic when stolen

## Implementation Tasks
- [ ] Token generation (1 to N)
- [ ] Selection logic (assign token to player)
- [ ] Stealing logic (transfer ownership)
- [ ] Ownership tracking
- [ ] History storage (array of 4 token selections)
- [ ] Conflict resolution (timestamp comparison)

## Type Safety
```javascript
// @ts-check

/**
 * @typedef {Object} Token
 * @property {number} number - Token number (1 to N)
 * @property {string|null} ownerId - Player ID who owns this token
 * @property {number} timestamp - When token was last selected
 */

/**
 * @typedef {Object} TokenAction
 * @property {'select'|'steal'} type - Action type
 * @property {string} playerId - Player performing action
 * @property {number} tokenNumber - Token number
 * @property {number} timestamp - Action timestamp
 */

/**
 * Generates N tokens for the game
 * @param {number} playerCount - Number of players (2-8)
 * @returns {Token[]} Array of tokens
 */

/**
 * Handles token selection/stealing with conflict resolution
 * @param {Token[]} tokens - Current token state
 * @param {TokenAction} action - Selection or steal action
 * @returns {Token[]} Updated token state
 */
```

## Files to Create/Modify
- `src/tokens.js` - Token system implementation
- `tests/tokens.test.js` - Comprehensive tests

## Acceptance Criteria
- [ ] Tokens numbered 1 to N (dynamic based on player count)
- [ ] Selection assigns token to player
- [ ] Stealing works (removes from original owner)
- [ ] Timestamp-based conflict resolution (earlier selection wins)
- [ ] Token history correctly tracks 4 turns
- [ ] All tests pass (`npm test`)
- [ ] >80% code coverage
- [ ] Type checking passes (`npm run typecheck`)

## Edge Cases to Test
- Simultaneous selection/steal (timestamp resolution)
- Stealing from player who doesn't own token
- Token history preserves order across 4 turns
- Multiple players fighting for same token
