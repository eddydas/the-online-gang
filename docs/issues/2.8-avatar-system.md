# Issue 2.8: Avatar System

**Sprint:** 2 v2
**Priority:** MEDIUM
**Estimate:** 5 hours
**Status:** TODO

## Description
Implement a simple avatar/icon system for players using emoji or initials. This provides visual identity for players at the poker table without requiring image uploads.

## User Story
As a player, I want to see visual avatars for each player at the table so that I can quickly identify who is who, especially in games with multiple players.

## Acceptance Criteria
- [ ] Each player has a visual avatar/icon
- [ ] Avatar displays player's initials (e.g., "AB" for Alice Brown)
- [ ] Avatar has a unique color per player
- [ ] Avatar displayed in:
  - Lobby player list
  - Poker table player positions
  - End-game results table
- [ ] Circular avatar design
- [ ] Responsive sizing (larger on desktop, smaller on mobile)
- [ ] Color generation is deterministic (same player = same color)
- [ ] High contrast text (readable initials)

## Avatar Design

### HTML Structure
```html
<div class="player-avatar" data-player-id="player1" style="--avatar-color: #3498db;">
  <span class="avatar-initials">AB</span>
</div>
```

### CSS Styling
```css
/* Avatar Container */
.player-avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: var(--avatar-color, #95a5a6);
  display: flex;
  align-items: center;
  justify-content: center;
  border: 3px solid white;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  position: relative;
}

/* Avatar Initials */
.avatar-initials {
  font-size: 24px;
  font-weight: bold;
  color: white;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  user-select: none;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

/* Sizes */
.player-avatar.small {
  width: 40px;
  height: 40px;
  border-width: 2px;
}

.player-avatar.small .avatar-initials {
  font-size: 16px;
}

.player-avatar.large {
  width: 80px;
  height: 80px;
  border-width: 4px;
}

.player-avatar.large .avatar-initials {
  font-size: 32px;
}

/* Mobile */
@media (max-width: 768px) {
  .player-avatar {
    width: 48px;
    height: 48px;
  }

  .avatar-initials {
    font-size: 18px;
  }
}
```

## JavaScript Implementation

### avatarManager.js
```javascript
/**
 * Avatar Manager for player visual identity
 */

/**
 * Predefined color palette for avatars
 * High contrast colors that work well on poker green background
 */
const AVATAR_COLORS = [
  '#3498db', // Blue
  '#e74c3c', // Red
  '#2ecc71', // Green
  '#f39c12', // Orange
  '#9b59b6', // Purple
  '#1abc9c', // Teal
  '#e67e22', // Dark Orange
  '#34495e', // Dark Blue-Gray
];

/**
 * Get initials from player name
 * @param {string} name - Player name
 * @returns {string} - Initials (1-2 characters)
 */
export function getInitials(name) {
  if (!name) return '?';

  const words = name.trim().split(/\s+/);

  if (words.length === 1) {
    // Single word: return first 2 characters
    return words[0].substring(0, 2).toUpperCase();
  } else {
    // Multiple words: return first letter of first 2 words
    return (words[0][0] + words[1][0]).toUpperCase();
  }
}

/**
 * Get deterministic color for player
 * Same player ID always gets same color
 * @param {string} playerId - Player ID
 * @returns {string} - Hex color code
 */
export function getAvatarColor(playerId) {
  // Simple hash function for deterministic color
  let hash = 0;
  for (let i = 0; i < playerId.length; i++) {
    hash = ((hash << 5) - hash) + playerId.charCodeAt(i);
    hash = hash & hash; // Convert to 32-bit integer
  }

  const index = Math.abs(hash) % AVATAR_COLORS.length;
  return AVATAR_COLORS[index];
}

/**
 * Create avatar element
 * @param {object} player - Player object with id and name
 * @param {string} size - 'small', 'medium', 'large'
 * @returns {HTMLElement}
 */
export function createAvatarElement(player, size = 'medium') {
  const avatar = document.createElement('div');
  avatar.className = `player-avatar ${size}`;
  avatar.dataset.playerId = player.id;

  const color = getAvatarColor(player.id);
  avatar.style.setProperty('--avatar-color', color);

  const initials = document.createElement('span');
  initials.className = 'avatar-initials';
  initials.textContent = getInitials(player.name);

  avatar.appendChild(initials);

  return avatar;
}
```

## Integration Points

### Lobby Player List
```javascript
import { createAvatarElement } from './avatarManager.js';

export function renderLobbyPlayers(players) {
  const container = document.getElementById('player-list');
  if (!container) return;

  container.innerHTML = '';

  players.forEach(player => {
    const playerItem = document.createElement('div');
    playerItem.className = 'lobby-player-item';

    // Add avatar
    const avatar = createAvatarElement(player, 'medium');

    // Add name
    const name = document.createElement('span');
    name.className = 'player-name';
    name.textContent = player.name;

    playerItem.appendChild(avatar);
    playerItem.appendChild(name);
    container.appendChild(playerItem);
  });
}
```

### Poker Table Player Position
```javascript
import { createAvatarElement } from './avatarManager.js';

export function renderTablePlayer(player, position) {
  const playerContainer = document.createElement('div');
  playerContainer.className = 'table-player';
  playerContainer.style.left = position.x;
  playerContainer.style.top = position.y;

  // Add avatar
  const avatar = createAvatarElement(player, 'large');

  // Add name label
  const nameLabel = document.createElement('div');
  nameLabel.className = 'player-name-label';
  nameLabel.textContent = player.name;

  playerContainer.appendChild(avatar);
  playerContainer.appendChild(nameLabel);

  return playerContainer;
}
```

### End-Game Table
```javascript
import { createAvatarElement } from './avatarManager.js';

export function renderEndGameTableRow(player, result) {
  const row = document.createElement('tr');

  // Avatar cell
  const avatarCell = document.createElement('td');
  const avatar = createAvatarElement(player, 'small');
  avatarCell.appendChild(avatar);

  // Name cell
  const nameCell = document.createElement('td');
  nameCell.textContent = player.name;

  // ... other cells (hand, token, result) ...

  row.appendChild(avatarCell);
  row.appendChild(nameCell);
  // ... append other cells ...

  return row;
}
```

## Player Name Label Component

### Combined Avatar + Name
```html
<div class="player-display">
  <div class="player-avatar" style="--avatar-color: #3498db;">
    <span class="avatar-initials">AB</span>
  </div>
  <div class="player-name-label">Alice Brown</div>
</div>
```

```css
.player-display {
  display: flex;
  align-items: center;
  gap: 12px;
}

.player-name-label {
  font-size: 16px;
  font-weight: 500;
  color: white;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

/* Mobile */
@media (max-width: 768px) {
  .player-display {
    gap: 8px;
  }

  .player-name-label {
    font-size: 14px;
  }
}
```

## Alternative: Emoji Avatars (Optional Enhancement)

If initials feel too basic, allow players to pick an emoji:

```javascript
const EMOJI_OPTIONS = [
  'ğŸ˜€', 'ğŸ˜', 'ğŸ¤“', 'ğŸ˜ˆ', 'ğŸ‘»', 'ğŸ¤¡', 'ğŸ¤–', 'ğŸ‘½',
  'ğŸ¶', 'ğŸ±', 'ğŸ¼', 'ğŸ¯', 'ğŸ¦', 'ğŸ¸', 'ğŸ¦Š', 'ğŸ»'
];

/**
 * Get emoji avatar for player (random or selected)
 * @param {string} playerId - Player ID
 * @returns {string} - Emoji character
 */
export function getEmojiAvatar(playerId) {
  // Deterministic emoji selection
  let hash = 0;
  for (let i = 0; i < playerId.length; i++) {
    hash = ((hash << 5) - hash) + playerId.charCodeAt(i);
    hash = hash & hash;
  }

  const index = Math.abs(hash) % EMOJI_OPTIONS.length;
  return EMOJI_OPTIONS[index];
}
```

## Edge Cases

### Long Names
```javascript
export function getInitials(name) {
  if (!name) return '?';

  // Remove special characters
  const cleanName = name.replace(/[^a-zA-Z\s]/g, '');

  const words = cleanName.trim().split(/\s+/);

  if (words.length === 0) return '?';

  if (words.length === 1) {
    return words[0].substring(0, 2).toUpperCase();
  } else {
    return (words[0][0] + words[1][0]).toUpperCase();
  }
}
```

### Empty or Special Character Names
```javascript
// Fallback for invalid names
if (!cleanName || cleanName.length === 0) {
  return '?';
}
```

## Files to Create/Modify
- `src/browser/avatarManager.js` - New avatar management module
- `src/browser/lobbyRenderer.js` - Add avatars to player list
- `src/browser/playerRenderer.js` - Add avatars to table positions
- `src/browser/endGameRenderer.js` - Add avatars to results table
- CSS file - Avatar styling

## Testing Checklist
- [ ] Initials display correctly for all names
- [ ] Initials are uppercase (e.g., "AB" not "ab")
- [ ] Single-word names show first 2 letters (e.g., "Alice" â†’ "AL")
- [ ] Multi-word names show first letter of each word (e.g., "Alice Brown" â†’ "AB")
- [ ] Special characters handled (e.g., "JosÃ© GarcÃ­a" â†’ "JG")
- [ ] Empty/invalid names show "?" fallback
- [ ] Same player always gets same color (deterministic)
- [ ] Colors are visually distinct (high contrast)
- [ ] Avatars display in lobby, table, and end-game
- [ ] Responsive sizing works (small, medium, large)
- [ ] Mobile display works correctly
- [ ] Border and shadow render correctly

## Accessibility
- [ ] Initials have sufficient color contrast
- [ ] Avatar has aria-label with player name
- [ ] Screen reader announces "Avatar for [Player Name]"

## Dependencies
- None (can be implemented independently)

## Notes
- Initials are simple, fast, and require no external assets
- Deterministic color ensures consistency across sessions
- High contrast colors work well on poker green background
- Consider emoji avatars as future enhancement
- No backend required - all avatar logic is client-side

## Definition of Done
- [ ] Avatars display for all players
- [ ] Initials generated correctly from names
- [ ] Colors are deterministic and visually distinct
- [ ] Avatars appear in lobby, table, and end-game
- [ ] Responsive sizing works on all devices
- [ ] Tested on Safari iOS, macOS, iPad
- [ ] Code passes typecheck
- [ ] Approved by product owner
