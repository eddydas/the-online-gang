# Issue 2.6: Card & Token Animations

**Sprint:** 2 v2
**Priority:** MEDIUM
**Estimate:** 8 hours
**Status:** TODO

## Description
Implement smooth CSS animations for cards and tokens to enhance the game experience. This includes card dealing animations, flipping animations, token selection effects, and phase transition animations.

## User Story
As a player, I want to see smooth animations for cards and tokens so that the game feels polished and professional, making game actions visually clear and engaging.

## Acceptance Criteria
- [ ] Card dealing animation (slide in from deck)
- [ ] Card flip animation (hole cards reveal)
- [ ] Community card reveal animation (flip from face-down)
- [ ] Token selection animation (scale + glow)
- [ ] Token steal animation (shake + transfer)
- [ ] Phase transition fade effects
- [ ] Smooth 60fps animations (no jank)
- [ ] Works on Safari iOS (no performance issues)
- [ ] Animations can be reduced/disabled (prefers-reduced-motion)

## Card Animations

### Card Dealing Animation
```css
@keyframes dealCard {
  0% {
    transform: translateX(-200px) translateY(-100px) scale(0.8);
    opacity: 0;
  }
  50% {
    opacity: 1;
  }
  100% {
    transform: translateX(0) translateY(0) scale(1);
    opacity: 1;
  }
}

.card.dealing {
  animation: dealCard 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

/* Stagger dealing with animation-delay */
.card.dealing:nth-child(1) { animation-delay: 0s; }
.card.dealing:nth-child(2) { animation-delay: 0.1s; }
.card.dealing:nth-child(3) { animation-delay: 0.2s; }
.card.dealing:nth-child(4) { animation-delay: 0.3s; }
.card.dealing:nth-child(5) { animation-delay: 0.4s; }
```

### Card Flip Animation
```css
@keyframes flipCard {
  0% {
    transform: rotateY(0deg) scale(1);
  }
  50% {
    transform: rotateY(90deg) scale(1.1);
  }
  100% {
    transform: rotateY(180deg) scale(1);
  }
}

.card.flipping {
  transform-style: preserve-3d;
  animation: flipCard 0.6s ease-in-out forwards;
}

/* Flip from back to face */
.card-face-down.flipping {
  animation-direction: normal;
}

/* Flip from face to back */
.card-face-up.flipping {
  animation-direction: reverse;
}
```

### Card Highlight Animation (Best Five)
```css
@keyframes highlightPulse {
  0%, 100% {
    box-shadow: 0 0 8px rgba(243, 156, 18, 0.6);
  }
  50% {
    box-shadow: 0 0 16px rgba(243, 156, 18, 1);
  }
}

.card.best-five {
  border: 2px solid #f39c12;
  animation: highlightPulse 1.5s ease-in-out infinite;
}
```

## Token Animations

### Token Selection Animation
```css
@keyframes tokenSelect {
  0% {
    transform: scale(1);
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  50% {
    transform: scale(1.2);
    box-shadow: 0 0 20px rgba(243, 156, 18, 1);
  }
  100% {
    transform: scale(1.15);
    box-shadow: 0 0 20px rgba(243, 156, 18, 0.8);
  }
}

.token.selected {
  animation: tokenSelect 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}
```

### Token Steal Animation
```css
@keyframes tokenShake {
  0%, 100% {
    transform: translateX(0) scale(1);
  }
  25% {
    transform: translateX(-5px) scale(1.05);
  }
  75% {
    transform: translateX(5px) scale(1.05);
  }
}

@keyframes tokenTransfer {
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
    transform: scale(0.8);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

.token.stolen {
  animation: tokenShake 0.3s ease-in-out;
}

.token.transferring {
  animation: tokenTransfer 0.5s ease-in-out forwards;
}
```

### Token Hover Animation
```css
.token:hover {
  transform: scale(1.1);
  box-shadow: 0 0 16px rgba(243, 156, 18, 0.6);
  transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.token:active {
  transform: scale(0.95);
  transition: transform 0.1s ease;
}
```

## Phase Transition Animations

### Fade In/Out
```css
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

.phase-transition-enter {
  animation: fadeIn 0.4s ease-in forwards;
}

.phase-transition-exit {
  animation: fadeOut 0.3s ease-out forwards;
}
```

### Slide Up Notification
```css
@keyframes slideUpFade {
  0% {
    transform: translateY(20px);
    opacity: 0;
  }
  100% {
    transform: translateY(0);
    opacity: 1;
  }
}

.phase-notification {
  animation: slideUpFade 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}
```

## JavaScript Animation Triggers

### Deal Cards
```javascript
/**
 * Animate dealing cards to player
 * @param {HTMLElement[]} cardElements - Card DOM elements
 */
function animateDealCards(cardElements) {
  cardElements.forEach((card, index) => {
    setTimeout(() => {
      card.classList.add('dealing');
      // Remove class after animation completes
      setTimeout(() => {
        card.classList.remove('dealing');
      }, 600);
    }, index * 100); // Stagger by 100ms
  });
}
```

### Flip Community Cards
```javascript
/**
 * Animate revealing community cards
 * @param {HTMLElement[]} cardElements - Community card elements
 */
function animateRevealCommunityCards(cardElements) {
  cardElements.forEach((card, index) => {
    setTimeout(() => {
      card.classList.add('flipping');

      // Change from face-down to face-up mid-flip
      setTimeout(() => {
        card.classList.remove('card-face-down');
        card.classList.add('card-face-up');
      }, 300); // Halfway through 600ms flip

      // Remove flipping class after animation
      setTimeout(() => {
        card.classList.remove('flipping');
      }, 600);
    }, index * 150); // Stagger by 150ms
  });
}
```

### Animate Token Selection
```javascript
/**
 * Animate token selection
 * @param {HTMLElement} tokenElement - Token DOM element
 */
function animateTokenSelect(tokenElement) {
  tokenElement.classList.add('selected');

  // Remove animation class after it completes
  setTimeout(() => {
    tokenElement.classList.remove('selected');
  }, 300);
}
```

### Animate Token Steal
```javascript
/**
 * Animate token being stolen
 * @param {HTMLElement} tokenElement - Token DOM element
 * @param {string} newOwnerId - New owner player ID
 */
function animateTokenSteal(tokenElement, newOwnerId) {
  // Shake animation
  tokenElement.classList.add('stolen');

  setTimeout(() => {
    tokenElement.classList.remove('stolen');

    // Transfer animation
    tokenElement.classList.add('transferring');

    setTimeout(() => {
      tokenElement.classList.remove('transferring');
      // Update token ownership visually here
    }, 500);
  }, 300);
}
```

## Performance Optimization

### Hardware Acceleration
```css
/* Force GPU acceleration for smooth animations */
.card,
.token {
  will-change: transform, opacity;
  transform: translateZ(0); /* Force GPU layer */
}

/* Only use will-change during animations */
.card.dealing,
.card.flipping,
.token.selected,
.token.stolen {
  will-change: transform, opacity;
}
```

### Reduced Motion Support
```css
/* Respect user's motion preferences */
@media (prefers-reduced-motion: reduce) {
  .card,
  .token,
  .phase-notification {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  .token:hover {
    transform: none;
  }
}
```

## Integration Points

### In cardRenderer.js
```javascript
export function renderCommunityCards(communityCards, animate = true) {
  const container = document.getElementById('community-cards');
  if (!container) return;

  // Clear existing cards
  container.innerHTML = '';

  // Create card elements
  const cardElements = communityCards.map(card => createCardElement(card));

  // Add to DOM
  cardElements.forEach(el => container.appendChild(el));

  // Animate if requested
  if (animate) {
    animateRevealCommunityCards(cardElements);
  }
}
```

### In tokenRenderer.js
```javascript
export function handleTokenClick(tokenNumber, playerId) {
  const tokenElement = document.querySelector(`.token[data-number="${tokenNumber}"]`);
  if (!tokenElement) return;

  const currentOwnerId = tokenElement.dataset.ownerId;

  if (currentOwnerId && currentOwnerId !== playerId) {
    // Token is being stolen
    animateTokenSteal(tokenElement, playerId);
  } else {
    // Token is being selected
    animateTokenSelect(tokenElement);
  }

  // ... rest of token action logic ...
}
```

## Files to Create/Modify
- `src/browser/animations.js` - New module for animation functions
- `src/browser/cardRenderer.js` - Add animation triggers when rendering cards
- `src/browser/tokenRenderer.js` - Add animation triggers for token actions
- CSS file - Add all animation keyframes and transitions

## Testing Checklist
- [ ] Card dealing animation smooth (60fps)
- [ ] Card flip animation works (face-down â†’ face-up)
- [ ] Community cards reveal with stagger effect
- [ ] Token selection animation scales and glows
- [ ] Token steal animation shakes then transfers
- [ ] Best five highlight pulses correctly
- [ ] Phase transitions fade smoothly
- [ ] No jank or stutter on Safari iOS
- [ ] Works on iPhone 12, 13, 14, 15
- [ ] Works on iPad (all sizes)
- [ ] prefers-reduced-motion disables animations
- [ ] GPU acceleration active (check with dev tools)

## Accessibility
- [ ] Animations respect prefers-reduced-motion
- [ ] No seizure-inducing flashing (< 3 flashes/sec)
- [ ] Animation states don't break screen readers
- [ ] Focus states still visible during animations

## Dependencies
- Issue 2.2 (Card Visual Design) - Card structure and styling
- Issue 2.3 (Token Visual Design) - Token structure and styling

## Notes
- Use `cubic-bezier(0.34, 1.56, 0.64, 1)` for bouncy effect
- Keep animation durations under 600ms for snappiness
- Stagger animations for visual flow (100-150ms delay)
- Use `will-change` sparingly (only during animation)
- Test on real devices - Safari iOS handles animations differently than desktop

## Definition of Done
- [ ] All card animations implemented and smooth
- [ ] All token animations implemented and smooth
- [ ] Phase transitions fade correctly
- [ ] 60fps performance on Safari iOS
- [ ] prefers-reduced-motion support working
- [ ] No visual glitches or jank
- [ ] Tested on iPhone, iPad, Vision Pro
- [ ] Code passes typecheck
- [ ] Approved by product owner
